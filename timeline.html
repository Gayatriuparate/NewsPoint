<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="timeline.css">
</head>

<<<<<<< HEAD
<body onload="loading()">
=======
<body onload="loadBlog();">

>>>>>>> a966fd89e3a3bb54b4d10d2b8408d4e8b893bb79
    <form>
        <nav>
            <ul style="list-style-type: none">
                <li class="navbar-title">Home</li>

                <li class="navbar-list">
                        <a href="login.html"> LogOut</a>

                </li>
                <li class="navbar-list">
                    <a href="profile.html">My Profile</a> </li>
            </ul>
        </nav>
        <hr>
        <div id="blogBody"></div>
        <!-- blog container -->
        <div>
            <footer>
                <input type="text" placeholder="Enter Title" id='title'></input>
                <input type="button" value="Post" onclick="insertBlog()">
                <textarea rows="10" cols="150" placeholder="write blog here." id='blog'></textarea>



            </footer>
        </div>
    </form>

    <script type="text/javascript">
        function loading(){
           alert(sessionStorage.getItem("lastname"));
        }
        function insertBlog() {
            let blogTitle = document.getElementById("title");
            let blogDesc = document.getElementById("blog");
            if (blogTitle.value != "" || blogDesc.value != "") {

                var oReq = new XMLHttpRequest();
                oReq.open('POST', '/blogReq', true);

                //Send the proper header information along with the request
                oReq.setRequestHeader('Content-type', 'test/plain');
                let params = { userNm: 's', title: blogTitle.value, blogDesc: blogDesc.value }
                oReq.onreadystatechange = function () {//Call a function when the state changes.
                    if (oReq.readyState == 4 && oReq.status == 200) {
                        if (oReq.responseText == "success") {
                            // sessionStorage.username = userNm;
                            let user = sessionStorage.getItem(username);
                            console.log(user);
                            // sessionStorage.setItem("SessionName","SessionData")
                            window.location = "./timeline.html";
                        } else {
                            alert("Blog Posted Successfully.");
                        }
                    }
                }
                oReq.send(JSON.stringify(params));
            } else {
                alert("Blog can not be emptily posted.");
            }
        }
        function loadBlog() {
            var oReq = new XMLHttpRequest();
            oReq.open('POST', '/postReq', true);
            oReq.setRequestHeader('Content-type', 'test/plain');
            oReq.onreadystatechange = function () {//Call a function when the state changes.
                if (oReq.readyState == 4 && oReq.status == 200) {
                    const result = JSON.parse(oReq.response);
                    let blogBody = document.getElementById("blogBody");
                    for (var blono = 0; blono < result.length; blono++) {

                        var blog = document.createElement("div");
                        blog.className = "blogContainer";
                        blog.id = 'r${blog}';
                        let blogdata = `${result[blono].title}:
                                         ${result[blono].blogDesc}`;
                        blog.innerText = blogdata;
                        blogBody.appendChild(blog);

                    }
                }
            }
            oReq.send("hhhh");

        }
    </script>
</body>

</html>